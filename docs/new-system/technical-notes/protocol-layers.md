# プロトコルのレイヤー整理

## 概要
「プロトコル」という用語は複数のレイヤーで使われるため、混乱しやすい。
ここでは、IoTシステムで扱う各種プロトコルをレイヤー別に整理する。

## プロトコルのレイヤー

### 1. 通信プロトコル（ネットワーク層）
データを**運ぶ方法**に関するプロトコル。

#### 主な例
- **MQTT**: IoT向けの軽量Pub/Subプロトコル
- **HTTP/HTTPS**: Web API通信
- **WebSocket**: リアルタイム双方向通信
- **CoAP**: 制約のあるデバイス向けプロトコル
- **AMQP**: メッセージキューイングプロトコル

### 2. 産業機器プロトコル（アプリケーション層）
機器から**データを取り出す方法**に関するプロトコル。

#### 主な例
- **Modbus**: レジスタベースの読み書きプロトコル
- **OPC UA**: 産業オートメーション向け標準
- **CC-Link**: 三菱電機の産業ネットワーク
- **FINS**: オムロンPLCプロトコル
- **MCプロトコル**: 三菱PLCプロトコル

### 3. 物理層プロトコル
実際の**電気信号**をどう送るか。

#### 主な例
- **RS-232C**: シリアル通信（1対1）
- **RS-485**: マルチドロップ対応シリアル
- **Ethernet**: 標準的なネットワーク
- **I2C**: センサー接続によく使用
- **SPI**: 高速センサー通信

## 実際のデータフローでの関係

```
[温度センサー] 
    ↓
[Modbus RTU]（機器プロトコル：データの読み方）
    ↓  
[RS-485]（物理層：電気信号）
    ↓
[ゲートウェイ]
    ↓
[MQTT]（通信プロトコル：データの運び方）
    ↓
[TCP/IP]（ネットワーク層）
    ↓
[サーバー]
```

## このプロジェクトでの扱い

### プラグインが担当する部分
- **機器プロトコル**の解釈（Modbus、独自バイナリ等）
- 物理層の違いの吸収（RS-485、Ethernet等）

### システムが使用する通信
- 統一形式データを**MQTT**や**HTTP API**で配信
- エッジ-サーバー間の通信に使用

## よくある混乱ポイント

1. **Modbus TCP/IP**
   - Modbus（機器プロトコル）をTCP/IP（通信プロトコル）で運ぶ
   - 2つのレイヤーが組み合わさっている

2. **MQTTでセンサーデータを送る**
   - センサーデータ（既に機器プロトコルで取得済み）を
   - MQTT（通信プロトコル）で配信

3. **プロトコル変換**
   - 通常は「機器プロトコル → 統一形式」の変換を指す
   - 通信プロトコルの変換（HTTP→MQTT等）とは別