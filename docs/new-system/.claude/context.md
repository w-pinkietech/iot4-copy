# プロジェクトコンテキスト

## プロジェクトビジョン

### 最終目標：日本の産業復活
このプロジェクトは単なる技術移行ではなく、**日本の産業構造を変革するキラーソフトウェア**の開発です。

#### 解決したい構造的問題
- **日本の産業のIT遅れ**: 自動車産業など技術的に優秀だが、IT活用が進まず進化が停滞
- **ITリテラシーの格差**: OSSでIoTをやっているのにGitHubを知らないレベルの技術格差
- **資金制約による非効率**: 商用サービスを使う予算がなく、知識不足で非効率なOSS実装
- **人材ミスマッチ**: AI普及によるエンジニアレイオフと、産業IoTの人材不足

#### 戦略的機会
- **AI時代の人材流動**: アメリカでのレイオフエンジニアが日本でも発生予測
- **製造業の受け皿需要**: ITリテラシー不足で適切な人材がいない製造業
- **OSSコミュニティの熱量**: 北九州等で既に導入実績があり、熱量の高いコミュニティが存在
- **技術格差の解消機会**: 高品質なOSSソフトウェアで競争力向上

## 概要
- **プロジェクト名**: IoT導入支援キット Ver.4.1 新システム移行
- **本質**: 日本の産業IoT人材エコシステム構築のインフラ
- **技術スタック**: Python/FastAPI + SQLite + InfluxDB + Streamlit
- **目標**: キラーソフトウェアとして日本の産業復活を支える技術基盤の構築

## 現状の課題
- **Node-REDフローの肥大化**: 1000ノード以上になり保守が困難
- **ハードウェア密結合**: BravePI/BraveJIGハードウェアに密結合したシステム
- **拡張困難**: 新しいセンサーやデバイスの追加が大変
- **AI支援限界**: ビジュアルプログラミングではAIによる開発支援が難しい

## 制約条件
- **既存データベース**: MariaDB(127.0.0.1:3306)とInfluxDB(127.0.0.1:8086)との互換性維持
- **実行環境**: Raspberry Pi 4 (メモリ4GB/8GB)
- **性能要件**: 10,000メッセージ/秒の処理能力（※要実測検証）
- **信頼性要件**: システム稼働率99.9%以上、データロスト率0.1%以下
- **言語**: Node-REDフローは日本語名を使用している

## 技術選定理由
- **Python/FastAPI**: 
  - 保守性と開発速度の観点から最適
  - AIツールによる開発支援が充実
  - IoTライブラリの充実
- **SQLite**: 
  - エッジゲートウェイに最適（軽量、ゼロ設定、高信頼性）
  - 設定管理用途に特化
- **InfluxDB**: 
  - 時系列データに特化、IoTデータ管理に理想的
  - 既存システムとの互換性
- **Streamlit**: 
  - 迅速なダッシュボード開発
  - Pythonエコシステムとの親和性

## アーキテクチャ方針
- **規模別配置戦略**: 小規模から大規模まで柔軟に対応可能な設計
- **プラグインアーキテクチャ**: 日本の産業界の独自プロトコル対応に特化
- **責任範囲の明確化**: Hardware Interface Driver, Sensor Controller, Application Serviceの3層分離
- **段階的データ処理**: Protocol Parser → Data Transformer の明確な分離

## 移行戦略
- **段階的移行**: 現行システムと並行稼働期間を設ける
- **MVP優先**: 基本機能に絞って実装、段階的に機能拡張
- **設定移行**: Node-REDフローから新システムへの設定移行を自動化

## データベース接続情報
- **MariaDB**: 127.0.0.1:3306, DB: iotkit, User: iotkit, Pass: iotkit-password
- **InfluxDB**: 127.0.0.1:8086, Org: fitc, Bucket: iotkit, Token: influxdb-iotkit-secret-token

## 主要ポート
- Node-RED: 1880
- MQTT: 1883, 51883
- MariaDB: 3306
- InfluxDB: 8086

## 配置戦略（2024-06-20決定）

### 規模別配置パターン
システムの規模に応じて最適な配置を選択できる柔軟な設計を採用

#### 小規模構成（単一Raspberry Pi）
```
[センサー] → [Hardware Driver] → [Sensor Controller] → [Service] → [Local DB]
                    ←------ 同一RPi ------→
```
- **対象**: 1-10センサー、単一拠点
- **メリット**: シンプル、低コスト、ネットワーク不要
- **用途**: 小規模工場、研究室、プロトタイプ

#### 中規模構成（エッジ + サーバー）
```
[センサー] → [RPi: Driver+Controller] → [Network] → [Server: Gateway+Service]
```
- **対象**: 10-100センサー、複数エッジデバイス
- **メリット**: エッジで前処理、サーバーで統合管理
- **用途**: 中規模工場、複数ライン管理

#### 大規模構成（分散処理）
```
[複数エッジ] → [複数ゲートウェイ] → [クラスター] → [企業システム]
```
- **対象**: 100+センサー、企業レベル
- **メリット**: 高可用性、負荷分散、企業システム連携
- **用途**: 大規模工場、企業全体のIoT管理

### 実装上の配慮
```yaml
# config.yaml - 設定による配置戦略の切り替え
deployment:
  mode: "standalone" | "edge-server" | "distributed"
  gateway_endpoint: "local" | "http://server:8080" | "https://cluster.example.com"
  
communication:
  local_priority: true  # ローカル通信を優先
  mqtt_fallback: true   # 必要時のみMQTT使用
```

### 通信方式の柔軟性
- **ローカル処理優先**: 不必要なネットワーク経由を回避
- **段階的拡張**: 小さく始めて大きくスケール
- **同一コードベース**: 配置方法のみ変更、コア処理は共通

## 重要な実装ポイント
- **セキュリティ**: MQTT通信のTLS暗号化、プラグインのサンドボックス化
- **エラーハンドリング**: ネットワーク断時のローカルバッファリング
- **運用**: 構造化ログ、監視、設定のバックアップ・リストア機能
- **拡張性**: 規模拡大時の配置変更が容易な設計

## MVP（最小実行可能製品）の方向性（2024-06-21決定）

### 解決すべき本質的課題
日本の製造業が抱える「**レガシー技術と多様なプロトコルの闇**」
- **設備の長期使用**: 20年、30年前の機器が現役で稼働
- **メーカー独自仕様**: 各社が独自プロトコルを採用、標準化失敗
- **統合の困難さ**: 異なるプロトコルの機器をつなげない
- **専門家依存とコスト**: 各プロトコルのカスタム開発が必要

### MVPで実証すべきこと
**「異なるメーカー・プロトコルの機器からデータを収集し、統一的に扱える」**

### 具体的なMVPシナリオ
ある工場に存在する多様な機器を統合：
- 20年前のオムロンのPLC（独自プロトコル）
- 15年前の三菱のシーケンサ（専用通信）
- 最新のModbus対応センサー
- 独自プロトコルの古い温度計

これらを**一つのシステムで統合**し、統一的にデータ収集・可視化

### MVPの最小構成要件
1. **2-3種類の異なるプロトコル対応**
   - 実在する工場で使われているプロトコルを選定
   - レガシーと現代的なものを混在

2. **統一データ形式への変換**
   - プロトコルに依存しない共通フォーマット
   - タイムスタンプ、値、単位、品質情報

3. **シンプルな可視化**
   - 異なる機器のデータを一画面で表示
   - 現場の人が価値を実感できるUI

4. **プラグイン追加の実証**
   - 新しいプロトコルを後から追加可能
   - 既存システムを停止せずに拡張

### MVPの成功基準
- **現場視点**: 「これなら他の機器もつなげそう」と思える
- **IT視点**: 「これなら保守・拡張できる」と思える
- **経営視点**: 「追加投資なしで既存設備を活用できる」と思える

### 既存システムの価値の継承
- **経済的アクセシビリティ**: お金のない会社でも実現可能
- **実績**: 北九州等での導入実績を活かす
- **熱量**: 既存コミュニティの熱意を維持